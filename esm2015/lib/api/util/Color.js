/**
 * Copyright (c) Tiny Technologies, Inc. All rights reserved.
 * Licensed under the LGPL or a commercial license.
 * For LGPL see License.txt in the project root for license information.
 * For commercial licenses see https://www.tiny.cloud/
 */
/**
 * This class lets you parse/serialize colors and convert rgb/hsb.
 *
 * @class tinymce.util.Color
 * @example
 * var white = new tinymce.util.Color({r: 255, g: 255, b: 255});
 * var red = new tinymce.util.Color('#FF0000');
 *
 * console.log(white.toHex(), red.toHsv());
 */
const min = Math.min, max = Math.max, round = Math.round;
/**
 * Constructs a new color instance.
 *
 * @constructor
 * @method Color
 * @param {String} value Optional initial value to parse.
 */
const Color = function (value) {
    const self = {};
    let r = 0, g = 0, b = 0;
    const rgb2hsv = function (r, g, b) {
        let h, s, v, d, minRGB, maxRGB;
        h = 0;
        s = 0;
        v = 0;
        r = r / 255;
        g = g / 255;
        b = b / 255;
        minRGB = min(r, min(g, b));
        maxRGB = max(r, max(g, b));
        if (minRGB === maxRGB) {
            v = minRGB;
            return {
                h: 0,
                s: 0,
                v: v * 100
            };
        }
        /*eslint no-nested-ternary:0 */
        d = (r === minRGB) ? g - b : ((b === minRGB) ? r - g : b - r);
        h = (r === minRGB) ? 3 : ((b === minRGB) ? 1 : 5);
        h = 60 * (h - d / (maxRGB - minRGB));
        s = (maxRGB - minRGB) / maxRGB;
        v = maxRGB;
        return {
            h: round(h),
            s: round(s * 100),
            v: round(v * 100)
        };
    };
    const hsvToRgb = function (hue, saturation, brightness) {
        let side, chroma, x, match;
        hue = (parseInt(hue, 10) || 0) % 360;
        saturation = parseInt(saturation, 10) / 100;
        brightness = parseInt(brightness, 10) / 100;
        saturation = max(0, min(saturation, 1));
        brightness = max(0, min(brightness, 1));
        if (saturation === 0) {
            r = g = b = round(255 * brightness);
            return;
        }
        side = hue / 60;
        chroma = brightness * saturation;
        x = chroma * (1 - Math.abs(side % 2 - 1));
        match = brightness - chroma;
        switch (Math.floor(side)) {
            case 0:
                r = chroma;
                g = x;
                b = 0;
                break;
            case 1:
                r = x;
                g = chroma;
                b = 0;
                break;
            case 2:
                r = 0;
                g = chroma;
                b = x;
                break;
            case 3:
                r = 0;
                g = x;
                b = chroma;
                break;
            case 4:
                r = x;
                g = 0;
                b = chroma;
                break;
            case 5:
                r = chroma;
                g = 0;
                b = x;
                break;
            default:
                r = g = b = 0;
        }
        r = round(255 * (r + match));
        g = round(255 * (g + match));
        b = round(255 * (b + match));
    };
    /**
     * Returns the hex string of the current color. For example: #ff00ff
     *
     * @method toHex
     * @return {String} Hex string of current color.
     */
    const toHex = function () {
        const hex = function (val) {
            val = parseInt(val, 10).toString(16);
            return val.length > 1 ? val : '0' + val;
        };
        return '#' + hex(r) + hex(g) + hex(b);
    };
    /**
     * Returns the r, g, b values of the color. Each channel has a range from 0-255.
     *
     * @method toRgb
     * @return {Object} Object with r, g, b fields.
     */
    const toRgb = function () {
        return {
            r,
            g,
            b
        };
    };
    /**
     * Returns the h, s, v values of the color. Ranges: h=0-360, s=0-100, v=0-100.
     *
     * @method toHsv
     * @return {Object} Object with h, s, v fields.
     */
    const toHsv = function () {
        return rgb2hsv(r, g, b);
    };
    /**
     * Parses the specified value and populates the color instance.
     *
     * Supported format examples:
     *  * rbg(255,0,0)
     *  * #ff0000
     *  * #fff
     *  * {r: 255, g: 0, b: 0}
     *  * {h: 360, s: 100, v: 100}
     *
     * @method parse
     * @param {Object/String} value Color value to parse.
     * @return {tinymce.util.Color} Current color instance.
     */
    const parse = function (value) {
        let matches;
        if (typeof value === 'object') {
            if ('r' in value) {
                r = value.r;
                g = value.g;
                b = value.b;
            }
            else if ('v' in value) {
                hsvToRgb(value.h, value.s, value.v);
            }
        }
        else {
            if ((matches = /rgb\s*\(\s*([0-9]+)\s*,\s*([0-9]+)\s*,\s*([0-9]+)[^\)]*\)/gi.exec(value))) {
                r = parseInt(matches[1], 10);
                g = parseInt(matches[2], 10);
                b = parseInt(matches[3], 10);
            }
            else if ((matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value))) {
                r = parseInt(matches[1], 16);
                g = parseInt(matches[2], 16);
                b = parseInt(matches[3], 16);
            }
            else if ((matches = /#([0-F])([0-F])([0-F])/gi.exec(value))) {
                r = parseInt(matches[1] + matches[1], 16);
                g = parseInt(matches[2] + matches[2], 16);
                b = parseInt(matches[3] + matches[3], 16);
            }
        }
        r = r < 0 ? 0 : (r > 255 ? 255 : r);
        g = g < 0 ? 0 : (g > 255 ? 255 : g);
        b = b < 0 ? 0 : (b > 255 ? 255 : b);
        return self;
    };
    if (value) {
        parse(value);
    }
    self.toRgb = toRgb;
    self.toHsv = toHsv;
    self.toHex = toHex;
    self.parse = parse;
    return self;
};
const ɵ0 = Color;
export default Color;
export { ɵ0 };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ29sb3IuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AcG9scHdhcmUvdGlueW1jZS11dGlsLyIsInNvdXJjZXMiOlsibGliL2FwaS91dGlsL0NvbG9yLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztHQUtHO0FBRUg7Ozs7Ozs7OztHQVNHO0FBRUgsTUFBTSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxHQUFHLEdBQUcsSUFBSSxDQUFDLEdBQUcsRUFBRSxLQUFLLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQztBQXFCekQ7Ozs7OztHQU1HO0FBQ0gsTUFBTSxLQUFLLEdBQUcsVUFBVSxLQUFNO0lBQzVCLE1BQU0sSUFBSSxHQUFRLEVBQUUsQ0FBQztJQUNyQixJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBRXhCLE1BQU0sT0FBTyxHQUFHLFVBQVUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDO1FBQy9CLElBQUksQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxNQUFNLENBQUM7UUFFL0IsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNOLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDTixDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ04sQ0FBQyxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUM7UUFDWixDQUFDLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQztRQUNaLENBQUMsR0FBRyxDQUFDLEdBQUcsR0FBRyxDQUFDO1FBRVosTUFBTSxHQUFHLEdBQUcsQ0FBQyxDQUFDLEVBQUUsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQzNCLE1BQU0sR0FBRyxHQUFHLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUUzQixJQUFJLE1BQU0sS0FBSyxNQUFNLEVBQUU7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QUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUNwQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBRXBDLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQyxDQUFDO0lBRUYsSUFBSSxLQUFLLEVBQUU7UUFDVCxLQUFLLENBQUMsS0FBSyxDQUFDLENBQUM7S0FDZDtJQUVELElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO0lBRW5CLE9BQU8sSUFBSSxDQUFDO0FBQ2QsQ0FBQyxDQUFDOztBQUVGLGVBQWUsS0FBSyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIFRpbnkgVGVjaG5vbG9naWVzLCBJbmMuIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTEdQTCBvciBhIGNvbW1lcmNpYWwgbGljZW5zZS5cbiAqIEZvciBMR1BMIHNlZSBMaWNlbnNlLnR4dCBpbiB0aGUgcHJvamVjdCByb290IGZvciBsaWNlbnNlIGluZm9ybWF0aW9uLlxuICogRm9yIGNvbW1lcmNpYWwgbGljZW5zZXMgc2VlIGh0dHBzOi8vd3d3LnRpbnkuY2xvdWQvXG4gKi9cblxuLyoqXG4gKiBUaGlzIGNsYXNzIGxldHMgeW91IHBhcnNlL3NlcmlhbGl6ZSBjb2xvcnMgYW5kIGNvbnZlcnQgcmdiL2hzYi5cbiAqXG4gKiBAY2xhc3MgdGlueW1jZS51dGlsLkNvbG9yXG4gKiBAZXhhbXBsZVxuICogdmFyIHdoaXRlID0gbmV3IHRpbnltY2UudXRpbC5Db2xvcih7cjogMjU1LCBnOiAyNTUsIGI6IDI1NX0pO1xuICogdmFyIHJlZCA9IG5ldyB0aW55bWNlLnV0aWwuQ29sb3IoJyNGRjAwMDAnKTtcbiAqXG4gKiBjb25zb2xlLmxvZyh3aGl0ZS50b0hleCgpLCByZWQudG9Ic3YoKSk7XG4gKi9cblxuY29uc3QgbWluID0gTWF0aC5taW4sIG1heCA9IE1hdGgubWF4LCByb3VuZCA9IE1hdGgucm91bmQ7XG5cbmludGVyZmFjZSBSR0Ige1xuICByOiBudW1iZXI7XG4gIGc6IG51bWJlcjtcbiAgYjogbnVtYmVyO1xufVxuXG5pbnRlcmZhY2UgSFNWIHtcbiAgaDogbnVtYmVyO1xuICBzOiBudW1iZXI7XG4gIHY6IG51bWJlcjtcbn1cblxuaW50ZXJmYWNlIENvbG9yIHtcbiAgdG9SZ2IgKCk6IFJHQjtcbiAgdG9Ic3YgKCk6IEhTVjtcbiAgdG9IZXggKCk6IHN0cmluZztcbiAgcGFyc2UgKHZhbHVlOiBzdHJpbmcgfCBSR0IgfCBIU1YpOiBDb2xvcjtcbn1cblxuLyoqXG4gKiBDb25zdHJ1Y3RzIGEgbmV3IGNvbG9yIGluc3RhbmNlLlxuICpcbiAqIEBjb25zdHJ1Y3RvclxuICogQG1ldGhvZCBDb2xvclxuICogQHBhcmFtIHtTdHJpbmd9IHZhbHVlIE9wdGlvbmFsIGluaXRpYWwgdmFsdWUgdG8gcGFyc2UuXG4gKi9cbmNvbnN0IENvbG9yID0gZnVuY3Rpb24gKHZhbHVlPyk6IENvbG9yIHtcbiAgY29uc3Qgc2VsZjogYW55ID0ge307XG4gIGxldCByID0gMCwgZyA9IDAsIGIgPSAwO1xuXG4gIGNvbnN0IHJnYjJoc3YgPSBmdW5jdGlvbiAociwgZywgYikge1xuICAgIGxldCBoLCBzLCB2LCBkLCBtaW5SR0IsIG1heFJHQjtcblxuICAgIGggPSAwO1xuICAgIHMgPSAwO1xuICAgIHYgPSAwO1xuICAgIHIgPSByIC8gMjU1O1xuICAgIGcgPSBnIC8gMjU1O1xuICAgIGIgPSBiIC8gMjU1O1xuXG4gICAgbWluUkdCID0gbWluKHIsIG1pbihnLCBiKSk7XG4gICAgbWF4UkdCID0gbWF4KHIsIG1heChnLCBiKSk7XG5cbiAgICBpZiAobWluUkdCID09PSBtYXhSR0IpIHtcbiAgICAgIHYgPSBtaW5SR0I7XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGg6IDAsXG4gICAgICAgIHM6IDAsXG4gICAgICAgIHY6IHYgKiAxMDBcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLyplc2xpbnQgbm8tbmVzdGVkLXRlcm5hcnk6MCAqL1xuICAgIGQgPSAociA9PT0gbWluUkdCKSA/IGcgLSBiIDogKChiID09PSBtaW5SR0IpID8gciAtIGcgOiBiIC0gcik7XG4gICAgaCA9IChyID09PSBtaW5SR0IpID8gMyA6ICgoYiA9PT0gbWluUkdCKSA/IDEgOiA1KTtcbiAgICBoID0gNjAgKiAoaCAtIGQgLyAobWF4UkdCIC0gbWluUkdCKSk7XG4gICAgcyA9IChtYXhSR0IgLSBtaW5SR0IpIC8gbWF4UkdCO1xuICAgIHYgPSBtYXhSR0I7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaDogcm91bmQoaCksXG4gICAgICBzOiByb3VuZChzICogMTAwKSxcbiAgICAgIHY6IHJvdW5kKHYgKiAxMDApXG4gICAgfTtcbiAgfTtcblxuICBjb25zdCBoc3ZUb1JnYiA9IGZ1bmN0aW9uIChodWUsIHNhdHVyYXRpb24sIGJyaWdodG5lc3MpIHtcbiAgICBsZXQgc2lkZSwgY2hyb21hLCB4LCBtYXRjaDtcblxuICAgIGh1ZSA9IChwYXJzZUludChodWUsIDEwKSB8fCAwKSAlIDM2MDtcbiAgICBzYXR1cmF0aW9uID0gcGFyc2VJbnQoc2F0dXJhdGlvbiwgMTApIC8gMTAwO1xuICAgIGJyaWdodG5lc3MgPSBwYXJzZUludChicmlnaHRuZXNzLCAxMCkgLyAxMDA7XG4gICAgc2F0dXJhdGlvbiA9IG1heCgwLCBtaW4oc2F0dXJhdGlvbiwgMSkpO1xuICAgIGJyaWdodG5lc3MgPSBtYXgoMCwgbWluKGJyaWdodG5lc3MsIDEpKTtcblxuICAgIGlmIChzYXR1cmF0aW9uID09PSAwKSB7XG4gICAgICByID0gZyA9IGIgPSByb3VuZCgyNTUgKiBicmlnaHRuZXNzKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBzaWRlID0gaHVlIC8gNjA7XG4gICAgY2hyb21hID0gYnJpZ2h0bmVzcyAqIHNhdHVyYXRpb247XG4gICAgeCA9IGNocm9tYSAqICgxIC0gTWF0aC5hYnMoc2lkZSAlIDIgLSAxKSk7XG4gICAgbWF0Y2ggPSBicmlnaHRuZXNzIC0gY2hyb21hO1xuXG4gICAgc3dpdGNoIChNYXRoLmZsb29yKHNpZGUpKSB7XG4gICAgICBjYXNlIDA6XG4gICAgICAgIHIgPSBjaHJvbWE7XG4gICAgICAgIGcgPSB4O1xuICAgICAgICBiID0gMDtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgMTpcbiAgICAgICAgciA9IHg7XG4gICAgICAgIGcgPSBjaHJvbWE7XG4gICAgICAgIGIgPSAwO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSAyOlxuICAgICAgICByID0gMDtcbiAgICAgICAgZyA9IGNocm9tYTtcbiAgICAgICAgYiA9IHg7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIDM6XG4gICAgICAgIHIgPSAwO1xuICAgICAgICBnID0geDtcbiAgICAgICAgYiA9IGNocm9tYTtcbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgNDpcbiAgICAgICAgciA9IHg7XG4gICAgICAgIGcgPSAwO1xuICAgICAgICBiID0gY2hyb21hO1xuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSA1OlxuICAgICAgICByID0gY2hyb21hO1xuICAgICAgICBnID0gMDtcbiAgICAgICAgYiA9IHg7XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBkZWZhdWx0OlxuICAgICAgICByID0gZyA9IGIgPSAwO1xuICAgIH1cblxuICAgIHIgPSByb3VuZCgyNTUgKiAociArIG1hdGNoKSk7XG4gICAgZyA9IHJvdW5kKDI1NSAqIChnICsgbWF0Y2gpKTtcbiAgICBiID0gcm91bmQoMjU1ICogKGIgKyBtYXRjaCkpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBoZXggc3RyaW5nIG9mIHRoZSBjdXJyZW50IGNvbG9yLiBGb3IgZXhhbXBsZTogI2ZmMDBmZlxuICAgKlxuICAgKiBAbWV0aG9kIHRvSGV4XG4gICAqIEByZXR1cm4ge1N0cmluZ30gSGV4IHN0cmluZyBvZiBjdXJyZW50IGNvbG9yLlxuICAgKi9cbiAgY29uc3QgdG9IZXggPSBmdW5jdGlvbiAoKSB7XG4gICAgY29uc3QgaGV4ID0gZnVuY3Rpb24gKHZhbCkge1xuICAgICAgdmFsID0gcGFyc2VJbnQodmFsLCAxMCkudG9TdHJpbmcoMTYpO1xuXG4gICAgICByZXR1cm4gdmFsLmxlbmd0aCA+IDEgPyB2YWwgOiAnMCcgKyB2YWw7XG4gICAgfTtcblxuICAgIHJldHVybiAnIycgKyBoZXgocikgKyBoZXgoZykgKyBoZXgoYik7XG4gIH07XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIHIsIGcsIGIgdmFsdWVzIG9mIHRoZSBjb2xvci4gRWFjaCBjaGFubmVsIGhhcyBhIHJhbmdlIGZyb20gMC0yNTUuXG4gICAqXG4gICAqIEBtZXRob2QgdG9SZ2JcbiAgICogQHJldHVybiB7T2JqZWN0fSBPYmplY3Qgd2l0aCByLCBnLCBiIGZpZWxkcy5cbiAgICovXG4gIGNvbnN0IHRvUmdiID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB7XG4gICAgICByLFxuICAgICAgZyxcbiAgICAgIGJcbiAgICB9O1xuICB9O1xuXG4gIC8qKlxuICAgKiBSZXR1cm5zIHRoZSBoLCBzLCB2IHZhbHVlcyBvZiB0aGUgY29sb3IuIFJhbmdlczogaD0wLTM2MCwgcz0wLTEwMCwgdj0wLTEwMC5cbiAgICpcbiAgICogQG1ldGhvZCB0b0hzdlxuICAgKiBAcmV0dXJuIHtPYmplY3R9IE9iamVjdCB3aXRoIGgsIHMsIHYgZmllbGRzLlxuICAgKi9cbiAgY29uc3QgdG9Ic3YgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHJnYjJoc3YociwgZywgYik7XG4gIH07XG5cbiAgLyoqXG4gICAqIFBhcnNlcyB0aGUgc3BlY2lmaWVkIHZhbHVlIGFuZCBwb3B1bGF0ZXMgdGhlIGNvbG9yIGluc3RhbmNlLlxuICAgKlxuICAgKiBTdXBwb3J0ZWQgZm9ybWF0IGV4YW1wbGVzOlxuICAgKiAgKiByYmcoMjU1LDAsMClcbiAgICogICogI2ZmMDAwMFxuICAgKiAgKiAjZmZmXG4gICAqICAqIHtyOiAyNTUsIGc6IDAsIGI6IDB9XG4gICAqICAqIHtoOiAzNjAsIHM6IDEwMCwgdjogMTAwfVxuICAgKlxuICAgKiBAbWV0aG9kIHBhcnNlXG4gICAqIEBwYXJhbSB7T2JqZWN0L1N0cmluZ30gdmFsdWUgQ29sb3IgdmFsdWUgdG8gcGFyc2UuXG4gICAqIEByZXR1cm4ge3RpbnltY2UudXRpbC5Db2xvcn0gQ3VycmVudCBjb2xvciBpbnN0YW5jZS5cbiAgICovXG4gIGNvbnN0IHBhcnNlID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgbGV0IG1hdGNoZXM7XG5cbiAgICBpZiAodHlwZW9mIHZhbHVlID09PSAnb2JqZWN0Jykge1xuICAgICAgaWYgKCdyJyBpbiB2YWx1ZSkge1xuICAgICAgICByID0gdmFsdWUucjtcbiAgICAgICAgZyA9IHZhbHVlLmc7XG4gICAgICAgIGIgPSB2YWx1ZS5iO1xuICAgICAgfSBlbHNlIGlmICgndicgaW4gdmFsdWUpIHtcbiAgICAgICAgaHN2VG9SZ2IodmFsdWUuaCwgdmFsdWUucywgdmFsdWUudik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICgobWF0Y2hlcyA9IC9yZ2JcXHMqXFwoXFxzKihbMC05XSspXFxzKixcXHMqKFswLTldKylcXHMqLFxccyooWzAtOV0rKVteXFwpXSpcXCkvZ2kuZXhlYyh2YWx1ZSkpKSB7XG4gICAgICAgIHIgPSBwYXJzZUludChtYXRjaGVzWzFdLCAxMCk7XG4gICAgICAgIGcgPSBwYXJzZUludChtYXRjaGVzWzJdLCAxMCk7XG4gICAgICAgIGIgPSBwYXJzZUludChtYXRjaGVzWzNdLCAxMCk7XG4gICAgICB9IGVsc2UgaWYgKChtYXRjaGVzID0gLyMoWzAtRl17Mn0pKFswLUZdezJ9KShbMC1GXXsyfSkvZ2kuZXhlYyh2YWx1ZSkpKSB7XG4gICAgICAgIHIgPSBwYXJzZUludChtYXRjaGVzWzFdLCAxNik7XG4gICAgICAgIGcgPSBwYXJzZUludChtYXRjaGVzWzJdLCAxNik7XG4gICAgICAgIGIgPSBwYXJzZUludChtYXRjaGVzWzNdLCAxNik7XG4gICAgICB9IGVsc2UgaWYgKChtYXRjaGVzID0gLyMoWzAtRl0pKFswLUZdKShbMC1GXSkvZ2kuZXhlYyh2YWx1ZSkpKSB7XG4gICAgICAgIHIgPSBwYXJzZUludChtYXRjaGVzWzFdICsgbWF0Y2hlc1sxXSwgMTYpO1xuICAgICAgICBnID0gcGFyc2VJbnQobWF0Y2hlc1syXSArIG1hdGNoZXNbMl0sIDE2KTtcbiAgICAgICAgYiA9IHBhcnNlSW50KG1hdGNoZXNbM10gKyBtYXRjaGVzWzNdLCAxNik7XG4gICAgICB9XG4gICAgfVxuXG4gICAgciA9IHIgPCAwID8gMCA6IChyID4gMjU1ID8gMjU1IDogcik7XG4gICAgZyA9IGcgPCAwID8gMCA6IChnID4gMjU1ID8gMjU1IDogZyk7XG4gICAgYiA9IGIgPCAwID8gMCA6IChiID4gMjU1ID8gMjU1IDogYik7XG5cbiAgICByZXR1cm4gc2VsZjtcbiAgfTtcblxuICBpZiAodmFsdWUpIHtcbiAgICBwYXJzZSh2YWx1ZSk7XG4gIH1cblxuICBzZWxmLnRvUmdiID0gdG9SZ2I7XG4gIHNlbGYudG9Ic3YgPSB0b0hzdjtcbiAgc2VsZi50b0hleCA9IHRvSGV4O1xuICBzZWxmLnBhcnNlID0gcGFyc2U7XG5cbiAgcmV0dXJuIHNlbGY7XG59O1xuXG5leHBvcnQgZGVmYXVsdCBDb2xvcjsiXX0=